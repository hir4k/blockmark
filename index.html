<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="src/styles.css">
</head>

<body>
    <div class="p-4">
        <div id="editor"></div>
    </div>

    <div class="test-buttons" style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
        <button onclick="saveEditor()"
            style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer;">Save
            Editor</button>
        <button onclick="loadEditor()"
            style="padding: 8px 16px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer;">Load
            Sample Data</button>
        <button onclick="loadYouTubeTest()"
            style="padding: 8px 16px; background: #f59e0b; color: white; border: none; border-radius: 4px; cursor: pointer;">Test
            YouTube Block</button>
        <button onclick="loadImageTest()"
            style="padding: 8px 16px; background: #8b5cf6; color: white; border: none; border-radius: 4px; cursor: pointer;">Test
            Image Block</button>
        <button onclick="configureImageUpload()"
            style="padding: 8px 16px; background: #ec4899; color: white; border: none; border-radius: 4px; cursor: pointer;">Configure
            Image Upload</button>
    </div>

    <div id="resultDisplay" class="result-display hidden">
        <h3>Saved Data (JSON Format)</h3>
        <pre id="resultData"></pre>
    </div>

    <script src="./src/index.js" type="module"></script>
    <script>
        function saveEditor() {
            const data = window.blockmarkEditor.save();
            const resultDisplay = document.getElementById('resultDisplay');
            const resultData = document.getElementById('resultData');

            // Format the JSON with proper indentation
            const formattedData = JSON.stringify(data, null, 2);
            resultData.textContent = formattedData;

            // Show the result display
            resultDisplay.classList.remove('hidden');

            // Scroll to the result
            resultDisplay.scrollIntoView({ behavior: 'smooth' });
        }

        function loadEditor() {
            const sampleData = [
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "Hello " },
                        { "text": "World", "bold": true }
                    ]
                },
                {
                    "type": "list",
                    "ordered": false,
                    "items": [
                        [{ "text": "Apple" }],
                        [{ "text": "Banana", "italic": true }],
                        [{ "text": "Orange" }]
                    ]
                },
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "This is a " },
                        { "text": "test", "underline": true },
                        { "text": " paragraph." }
                    ]
                }
            ];

            window.blockmarkEditor.load(sampleData);

            // Hide the result display when loading new data
            document.getElementById('resultDisplay').classList.add('hidden');

            alert('Sample data loaded!');
        }

        function loadYouTubeTest() {
            const sampleData = [
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "Here's a YouTube video:" }
                    ]
                },
                {
                    "type": "youtube",
                    "url": "https://www.youtube.com/watch?v=dQw4w9WgXcQ"
                },
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "And another one:" }
                    ]
                },
                {
                    "type": "youtube",
                    "url": ""
                }
            ];

            window.blockmarkEditor.load(sampleData);

            // Hide the result display when loading new data
            document.getElementById('resultDisplay').classList.add('hidden');

            alert('YouTube test data loaded! You can edit the empty YouTube block by clicking on it.');
        }

        function loadImageTest() {
            const sampleData = [
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "Here's an image:" }
                    ]
                },
                {
                    "type": "image",
                    "src": "",
                    "alt": "",
                    "caption": ""
                },
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "You can upload an image by clicking on the image block above." }
                    ]
                }
            ];

            window.blockmarkEditor.load(sampleData);

            // Hide the result display when loading new data
            document.getElementById('resultDisplay').classList.add('hidden');

            alert('Image test data loaded! Click on the image block to upload an image.');
        }

        function configureImageUpload() {
            const uploadUrl = prompt('Enter your image upload API endpoint:', 'http://localhost:3001/api/upload-image');
            if (uploadUrl) {
                // Create a custom upload function
                const customUploadFunction = async (file) => {
                    const formData = new FormData();
                    formData.append('image', file);

                    const response = await fetch(uploadUrl, {
                        method: 'POST',
                        headers: {
                            'Authorization': 'Bearer your-token-here' // Add your auth headers
                        },
                        body: formData
                    });

                    if (!response.ok) {
                        throw new Error(`Upload failed: ${response.status} ${response.statusText}`);
                    }

                    const result = await response.json();
                    return result.url || result.imageUrl || result.src;
                };

                window.setImageUploadFunction(customUploadFunction);
                alert('Image upload function updated! The next image upload will use your custom function.');
            }
        }
    </script>
</body>

</html>