<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="src/styles.css">
</head>

<body>
    <div class="p-4">
        <div id="editor"></div>
    </div>

    <div class="test-buttons" style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
        <button onclick="saveEditor()"
            style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer;">Save
            Editor</button>
        <button onclick="loadEditor()"
            style="padding: 8px 16px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer;">Load
            Sample Data</button>
        <button onclick="loadYouTubeTest()"
            style="padding: 8px 16px; background: #f59e0b; color: white; border: none; border-radius: 4px; cursor: pointer;">Test
            YouTube Block</button>
        <button onclick="loadImageTest()"
            style="padding: 8px 16px; background: #8b5cf6; color: white; border: none; border-radius: 4px; cursor: pointer;">Test
            Image Block</button>
        <button onclick="configureImageUpload()"
            style="padding: 8px 16px; background: #ec4899; color: white; border: none; border-radius: 4px; cursor: pointer;">Configure
            Image Upload</button>
        <button onclick="loadParagraphSplitTest()"
            style="padding: 8px 16px; background: #06b6d4; color: white; border: none; border-radius: 4px; cursor: pointer;">Test
            Paragraph Split</button>
        <button onclick="testTextCleaning()"
            style="padding: 8px 16px; background: #059669; color: white; border: none; border-radius: 4px; cursor: pointer;">Test
            Text Cleaning</button>
        <button onclick="testUnicodeText()"
            style="padding: 8px 16px; background: #7c3aed; color: white; border: none; border-radius: 4px; cursor: pointer;">Test
            Unicode Text</button>
    </div>

    <div id="resultDisplay" class="result-display hidden">
        <h3>Saved Data (JSON Format)</h3>
        <pre id="resultData"></pre>
    </div>

    <script src="./src/index.js" type="module"></script>
    <script>
        function saveEditor() {
            const data = window.blockmarkEditor.save();
            const resultDisplay = document.getElementById('resultDisplay');
            const resultData = document.getElementById('resultData');

            // Format the JSON with proper indentation
            const formattedData = JSON.stringify(data, null, 2);
            resultData.textContent = formattedData;

            // Show the result display
            resultDisplay.classList.remove('hidden');

            // Scroll to the result
            resultDisplay.scrollIntoView({ behavior: 'smooth' });
        }

        function loadEditor() {
            const sampleData = [
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "Hello " },
                        { "text": "World", "bold": true }
                    ]
                },
                {
                    "type": "list",
                    "ordered": false,
                    "items": [
                        [{ "text": "Apple" }],
                        [{ "text": "Banana", "italic": true }],
                        [{ "text": "Orange" }]
                    ]
                },
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "This is a " },
                        { "text": "test", "underline": true },
                        { "text": " paragraph." }
                    ]
                }
            ];

            window.blockmarkEditor.load(sampleData);

            // Hide the result display when loading new data
            document.getElementById('resultDisplay').classList.add('hidden');

            alert('Sample data loaded!');
        }

        function loadYouTubeTest() {
            const sampleData = [
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "Here's a YouTube video:" }
                    ]
                },
                {
                    "type": "youtube",
                    "url": "https://www.youtube.com/watch?v=dQw4w9WgXcQ"
                },
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "And another one:" }
                    ]
                },
                {
                    "type": "youtube",
                    "url": ""
                }
            ];

            window.blockmarkEditor.load(sampleData);

            // Hide the result display when loading new data
            document.getElementById('resultDisplay').classList.add('hidden');

            alert('YouTube test data loaded! You can edit the empty YouTube block by clicking on it.');
        }

        function loadImageTest() {
            const sampleData = [
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "Here's an image:" }
                    ]
                },
                {
                    "type": "image",
                    "src": "",
                    "alt": "",
                    "caption": ""
                },
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "You can upload an image by clicking on the image block above." }
                    ]
                }
            ];

            window.blockmarkEditor.load(sampleData);

            // Hide the result display when loading new data
            document.getElementById('resultDisplay').classList.add('hidden');

            alert('Image test data loaded! Click on the image block to upload an image.');
        }

        function configureImageUpload() {
            const uploadUrl = prompt('Enter your image upload API endpoint:', 'http://localhost:3001/api/upload-image');
            if (uploadUrl) {
                // Create a custom upload function
                const customUploadFunction = async (file) => {
                    const formData = new FormData();
                    formData.append('image', file);

                    const response = await fetch(uploadUrl, {
                        method: 'POST',
                        headers: {
                            'Authorization': 'Bearer your-token-here' // Add your auth headers
                        },
                        body: formData
                    });

                    if (!response.ok) {
                        throw new Error(`Upload failed: ${response.status} ${response.statusText}`);
                    }

                    const result = await response.json();
                    return result.url || result.imageUrl || result.src;
                };

                window.setImageUploadFunction(customUploadFunction);
                alert('Image upload function updated! The next image upload will use your custom function.');
            }
        }

        function loadParagraphSplitTest() {
            const sampleData = [
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "Hello world" }
                    ]
                },
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "This is a test paragraph with some text that you can split." }
                    ]
                },
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "Place your cursor in the middle of this text and press Enter to split it into two paragraphs." }
                    ]
                },
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "This paragraph can be merged with the previous one using backspace at the beginning." }
                    ]
                },
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "This paragraph has line breaks\nand tabs\tthat will be cleaned on save." }
                    ]
                }
            ];

            window.blockmarkEditor.load(sampleData);

            // Hide the result display when loading new data
            document.getElementById('resultDisplay').classList.add('hidden');

            alert('Paragraph split/merge test loaded!\n\nEnter key:\n- Place cursor in the middle of text and press Enter to split\n- Place cursor at the end and press Enter for new paragraph\n\nBackspace key:\n- Place cursor at the beginning and press Backspace to merge with previous paragraph\n- Place cursor in the middle/end and press Backspace for normal deletion\n\nText cleaning:\n- Line breaks, tabs, and extra whitespace are automatically cleaned on save');
        }

        function testTextCleaning() {
            const sampleData = [
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "This text has\nmultiple\nline breaks" }
                    ]
                },
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "This text has\t\t\ttabs\tand\t\tspaces" }
                    ]
                },
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "This text has    multiple    spaces    between    words" }
                    ]
                },
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "Mixed formatting:\n\tLine with tab\n\t\tDouble tab\n   Spaces at start" }
                    ]
                },
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "   Text with leading spaces" }
                    ]
                },
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "Text with trailing spaces   " }
                    ]
                }
            ];

            window.blockmarkEditor.load(sampleData);

            // Hide the result display when loading new data
            document.getElementById('resultDisplay').classList.add('hidden');

            alert('Text cleaning test loaded!\n\nThis demonstrates how line breaks and tabs are cleaned while preserving leading and trailing spaces.\n\nTry editing the text and then click "Save Editor" to see the cleaned output.');
        }

        function testUnicodeText() {
            const sampleData = [
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "সকল নিগমে যাক বিচাৰি নাপায় ॥" }
                    ]
                },
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "বাংলা টেক্সট\nনতুন লাইন\nট্যাব\tস্পেস" }
                    ]
                },
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "हिंदी टेक्स्ट\tटैब के साथ\nनई लाइन" }
                    ]
                },
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "العربية نص\tمع تبويب\nسطر جديد" }
                    ]
                },
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "   বাংলা টেক্সট with leading spaces" }
                    ]
                },
                {
                    "type": "paragraph",
                    "text": [
                        { "text": "বাংলা টেক্সট with trailing spaces   " }
                    ]
                }
            ];

            window.blockmarkEditor.load(sampleData);

            // Hide the result display when loading new data
            document.getElementById('resultDisplay').classList.add('hidden');

            alert('Unicode text test loaded!\n\nThis tests how the editor handles various Unicode characters including Bengali, Hindi, and Arabic text with line breaks and tabs.\n\nLeading and trailing spaces are preserved while line breaks and tabs are cleaned.\n\nClick "Save Editor" to see if the Unicode characters are preserved correctly in the JSON output.');
        }
    </script>
</body>

</html>